plugins {
    id 'java'
    id 'groovy'
    id 'java-gradle-plugin'
    id "com.gradle.plugin-publish" version "1.0.0-rc-1"
    id 'maven-publish'
}

ext {
    publishingPath = version.toString().contains("SNAPSHOT") ? 'snapshots' : 'internal'
    pluginDescription = 'A template for create a gradle plugin'
}

sourceCompatibility = 1.11

pluginBundle {
    website = '<UPDATE>'
    vcsUrl = '<UPDATE>'
    description = pluginDescription
    tags = ['<UPDATE>']
}

gradlePlugin {
    plugins {
        templateGradlePlugin {
            id = 'xyz.ronella.gradle.plugin'
            displayName = 'Template Gradle Plugin'
            description = pluginDescription
            implementationClass = 'xyz.ronella.gradle.plugin.TemplateGradlePlugin'
        }
    }
}

publishing {
    publications {
        repositories.maven {
            url "https://repo.ronella.xyz/archiva/repository/${publishingPath}/"
            credentials {
                username "${archivaUsername}"
                password "${archivaPassword}"
            }
        }
    }
}

repositories {
    if (Boolean.valueOf(USE_PRIVATE_REPO)) {
        println "Using Private Repository"

        maven {
            url 'https://repo.ronella.xyz/artifactory/java-central'
            credentials {
                username "${artifactoryUsername}"
                password "${artifactoryPassword}"
            }
            mavenContent {
                releasesOnly()
            }
        }
        maven {
            url 'https://repo.ronella.xyz/archiva/repository/snapshots/'
            credentials {
                username "${archivaUsername}"
                password "${archivaPassword}"
            }
            mavenContent {
                snapshotsOnly()
            }
        }
    }
    else {
        println "Using mavenCentral Repository"
        mavenCentral()
    }
}

dependencies {
    implementation gradleApi()
    implementation localGroovy()

    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.8.2'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.8.2'

    testImplementation 'org.mockito:mockito-core:4.4.0'
    testImplementation 'org.mockito:mockito-inline:4.4.0'
}

test {
    useJUnitPlatform()
}
